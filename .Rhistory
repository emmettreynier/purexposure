devtools::document()
packageVersion("tidyr")
packageVersion("ggmap")
packageVersion("colormap")
packageVersion(grDevices)
packageVersion("grDevices")
packageVersion("methods")
packageVersion("zoo")
getwd()
pull_product_table <- function(year) {
dir <- paste0("~/Documents/pesticides_project/data-raw/PUR/", year)
current_dir <- getwd()
setwd(dir)
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, prodcut_name, show_regno,
aer_grnd_ind, formula_cd, full_exp_dt, full_iss_dt,
fumigant_sw, gen_pest_ind, lastup_dt, mfg_ref_sw,
prod_inac_dt, reg_dt, reg_type_ind, rodent_sw, rignlwrd_ind,
soilappl_sw, condreg_sw)
return(product_file)
}
product_list <- purrr::map(1990:2015, pull_product_table)
product_list <- purrr::map(1990:2015, pull_product_table)
pull_product_table <- function(year) {
dir <- paste0("~/Documents/pesticides_project/data-raw/PUR/", year)
current_dir <- getwd()
setwd(dir)
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, show_regno,
aer_grnd_ind, formula_cd, full_exp_dt, full_iss_dt,
fumigant_sw, gen_pest_ind, lastup_dt, mfg_ref_sw,
prod_inac_dt, reg_dt, reg_type_ind, rodent_sw, rignlwrd_ind,
soilappl_sw, condreg_sw)
return(product_file)
}
product_list <- purrr::map(1990:2015, pull_product_table)
pull_product_table <- function(year) {
dir <- paste0("~/Documents/pesticides_project/data-raw/PUR/", year)
current_dir <- getwd()
setwd(dir)
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, show_regno,
aer_grnd_ind, formula_cd, full_exp_dt, full_iss_dt,
fumigant_sw, gen_pest_ind, lastup_dt, mfg_ref_sw,
prod_inac_dt, reg_dt, reg_type_ind, rodent_sw, signlwrd_ind,
soilappl_sw, condreg_sw)
return(product_file)
}
product_list <- purrr::map(1990:2015, pull_product_table)
names(product_list) <- 1990:2015
product_list
usethis::use_data(product_list, overwrite = TRUE)
pull_product_table <- function(year) {
dir <- paste0("~/Documents/pesticides_project/data-raw/PUR/", year)
current_dir <- getwd()
setwd(dir)
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, show_regno,
aer_grnd_ind, formula_cd, full_exp_dt, full_iss_dt,
fumigant_sw, gen_pest_ind, lastup_dt, mfg_ref_sw,
prod_inac_dt, reg_dt, reg_type_ind, rodent_sw, signlwrd_ind,
soilappl_sw, condreg_sw)
return(product_file)
}
pull_product_table <- function(year) {
dir <- paste0("~/Documents/pesticides_project/data-raw/PUR/", year)
current_dir <- getwd()
setwd(dir)
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, show_regno,
aer_grnd_ind, formula_cd, full_exp_dt, full_iss_dt,
fumigant_sw, gen_pest_ind, lastup_dt, mfg_ref_sw,
prod_inac_dt, reg_dt, reg_type_ind, rodent_sw, signlwrd_ind,
soilappl_sw, condreg_sw)
setwd(current_dir)
return(product_file)
}
product_list <- purrr::map(1990:2015, pull_product_table)
library(readr)
library(usethis)
library(purrr)
library(dplyr)
pull_product_table <- function(year) {
dir <- paste0("~/Documents/pesticides_project/data-raw/PUR/", year)
current_dir <- getwd()
setwd(dir)
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, show_regno,
aer_grnd_ind, formula_cd, full_exp_dt, full_iss_dt,
fumigant_sw, gen_pest_ind, lastup_dt, mfg_ref_sw,
prod_inac_dt, reg_dt, reg_type_ind, rodent_sw, signlwrd_ind,
soilappl_sw, condreg_sw)
setwd(current_dir)
return(product_file)
}
product_list <- purrr::map(1990:2015, pull_product_table)
names(product_list) <- 1990:2015
getwd()
setwd("~/Documents/purexposure")
getwd()
pull_product_table <- function(year) {
dir <- paste0("~/Documents/pesticides_project/data-raw/PUR/", year)
current_dir <- getwd()
setwd(dir)
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, show_regno,
aer_grnd_ind, formula_cd, full_exp_dt, full_iss_dt,
fumigant_sw, gen_pest_ind, lastup_dt, mfg_ref_sw,
prod_inac_dt, reg_dt, reg_type_ind, rodent_sw, signlwrd_ind,
soilappl_sw, condreg_sw)
setwd(current_dir)
return(product_file)
}
pull_product_table(1990)
getwd()
pull_product_table <- function(year) {
dir <- paste0("~/Documents/pesticides_project/data-raw/PUR/", year)
current_dir <- getwd()
setwd(dir)
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, show_regno,
aer_grnd_ind, formula_cd, full_exp_dt, full_iss_dt,
fumigant_sw, gen_pest_ind, lastup_dt, mfg_ref_sw,
prod_inac_dt, reg_dt, reg_type_ind, rodent_sw, signlwrd_ind,
soilappl_sw, condreg_sw)
setwd(current_dir)
return(product_file)
}
product_list <- purrr::map(1990:2015, pull_product_table)
getwd()
names(product_list) <- 1990:2015
usethis::use_data(product_list, overwrite = TRUE)
pull_product_table <- function(year) {
dir <- paste0("~/Documents/pesticides_project/data-raw/PUR/", year)
current_dir <- getwd()
setwd(dir)
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, signlwrd_ind)
setwd(current_dir)
return(product_file)
}
product_list <- purrr::map(1990:2015, pull_product_table)
names(product_list) <- 1990:2015
usethis::use_data(product_list, overwrite = TRUE)
chemicals <- purexposure::chemical_list
head(chemicals)
library(purexposure)
prod <- purexposure::product_list
head(prod)
devtools::load_all()
devtools::document()
?pull_product_table
test <- pull_product_table(1995)
year
year <- 1995
url <- paste0("ftp://transfer.cdpr.ca.gov/pub/outgoing/pur_archives/pur",
year, ".zip")
file <- paste0("pur", year, ".zip")
current_dir <- getwd()
dir <- tempdir()
current_dir
download.file(url, destfile = file, mode = "wb")
unzip(file, exdir = dir)
setwd(dir)
product_file <- readr::read_csv("product.txt")
product_file
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, signlwrd_ind)
product_file
suppressWarnings(suppressMessages(
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, signlwrd_ind)
))
product_file
suppressWarnings(suppressMessages(
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, signlwrd_ind) %>%
dplyr::mutate(prono = as.integer(prodno),
prodstat_ind = as.character(prodstat_ind),
product_name = as.character(product_name),
signlwrd_ind = as.integer(signlwrd_ind))
))
product_file
setwd(current_dir)
getwd()
pull_product_table <- function(year) {
url <- paste0("ftp://transfer.cdpr.ca.gov/pub/outgoing/pur_archives/pur",
year, ".zip")
file <- paste0("pur", year, ".zip")
current_dir <- getwd()
dir <- tempdir()
download.file(url, destfile = file, mode = "wb")
unzip(file, exdir = dir)
setwd(dir)
suppressWarnings(suppressMessages(
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, signlwrd_ind) %>%
dplyr::mutate(prono = as.integer(prodno),
prodstat_ind = as.character(prodstat_ind),
product_name = as.character(product_name),
signlwrd_ind = as.integer(signlwrd_ind))
))
setwd(current_dir)
return(product_file)
}
pull_product_table <- function(year, download_progress = FALSE) {
url <- paste0("ftp://transfer.cdpr.ca.gov/pub/outgoing/pur_archives/pur",
year, ".zip")
file <- paste0("pur", year, ".zip")
current_dir <- getwd()
dir <- tempdir()
if (download_progress) {
quiet <- FALSE
} else {
quiet <- TRUE
}
download.file(url, destfile = file, mode = "wb")
unzip(file, exdir = dir)
setwd(dir)
suppressWarnings(suppressMessages(
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, signlwrd_ind) %>%
dplyr::mutate(prono = as.integer(prodno),
prodstat_ind = as.character(prodstat_ind),
product_name = as.character(product_name),
signlwrd_ind = as.integer(signlwrd_ind))
))
setwd(current_dir)
return(product_file)
}
pull_product_table <- function(year, download_progress = FALSE) {
url <- paste0("ftp://transfer.cdpr.ca.gov/pub/outgoing/pur_archives/pur",
year, ".zip")
file <- paste0("pur", year, ".zip")
current_dir <- getwd()
dir <- tempdir()
if (download_progress) {
quiet <- FALSE
} else {
quiet <- TRUE
}
download.file(url, destfile = file, mode = "wb", quiet = quiet)
unzip(file, exdir = dir)
setwd(dir)
suppressWarnings(suppressMessages(
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, signlwrd_ind) %>%
dplyr::mutate(prono = as.integer(prodno),
prodstat_ind = as.character(prodstat_ind),
product_name = as.character(product_name),
signlwrd_ind = as.integer(signlwrd_ind))
))
setwd(current_dir)
return(product_file)
}
prod_95 <- pull_product_table(1995)
prod_95
prod_97 <- pull_product_table(1997)
prod_97
prod_15 <- pull_product_table(2015)
prod_15
tail(prod_95)
tail(prod_15)
filter(prod_15, prodno == 47928)
filter(prod_95, prodno == 47928)
devtools::load_all()
test <- pull_clean_pur(1995, "fresno")
head(test)
devtools::load_all()
test <- pull_clean_pur(1995, "fresno")
head(test)
prod_table <- pull_product_table(2003)
head(prod_table)
find_chemical_codes(2000, "methyl bromide")
find_chemical_codes(2004)
find_product_name <- function(year, product = "all") {
df <- pull_product_table(year)
help_find_product <- function(product) {
quotemeta <- function(string) {
stringr::str_replace_all(string, "(\\W)", "\\\\\\1")
}
prod_up <- toupper(product)
prod_up <- substr(prod_up, 1, 50)
if (prod_up == "ALL") {
df2 <- df
} else {
df2 <- df[grep(quotemeta(prod_up), df$product_name), ]
df2 <- df2 %>% dplyr::mutate(product = product)
}
return(df2)
}
out <- purrr::map(products, help_pull_product) %>%
unique()
return(out)
}
tail(prod_table)
test <- find_product_name(2000, c("mosquito beater", "herbicide"))
find_product_name <- function(year, product = "all") {
df <- pull_product_table(year)
help_find_product <- function(product) {
quotemeta <- function(string) {
stringr::str_replace_all(string, "(\\W)", "\\\\\\1")
}
prod_up <- toupper(product)
prod_up <- substr(prod_up, 1, 50)
if (prod_up == "ALL") {
df2 <- df
} else {
df2 <- df[grep(quotemeta(prod_up), df$product_name), ]
df2 <- df2 %>% dplyr::mutate(product = product)
}
return(df2)
}
out <- purrr::map(products, help_find_product) %>%
unique()
return(out)
}
test <- find_product_name(2000, c("mosquito beater", "herbicide"))
find_product_name <- function(year, products = "all") {
df <- pull_product_table(year)
out <- purrr::map(products, help_find_product) %>%
unique()
return(out)
}
help_find_product <- function(product) {
quotemeta <- function(string) {
stringr::str_replace_all(string, "(\\W)", "\\\\\\1")
}
prod_up <- toupper(product)
prod_up <- substr(prod_up, 1, 50)
if (prod_up == "ALL") {
df2 <- df
} else {
df2 <- df[grep(quotemeta(prod_up), df$product_name), ]
df2 <- df2 %>% dplyr::mutate(product = product)
}
return(df2)
}
test <- find_product_name(2000, c("mosquito beater", "herbicide"))
year <- 2000
products <- c("mosquito beater", "herbicide")
df <- pull_product_table(year)
df
product <- products[1]
quotemeta <- function(string) {
stringr::str_replace_all(string, "(\\W)", "\\\\\\1")
}
quotemeta
prod_up <- toupper(product)
prod_up <- substr(prod_up, 1, 50)
if (prod_up == "ALL") {
df2 <- df
} else {
df2 <- df[grep(quotemeta(prod_up), df$product_name), ]
df2 <- df2 %>% dplyr::mutate(product = product)
}
?map_dfr
find_chemical_codes <- function(year, chemicals = "all") {
df <- purexposure::chemical_list
df <- df[[as.character(year)]]
out <- purrr::map_dfr(chemicals, help_find_code, df)  %>%
unique()
return(out)
}
devtools::load_all()
devtools::load_all()
find_chemical_codes(2000, "methyl bromide")
find_chemical_codes(1995, c("ammonia", "benzene"))
df
df2
products
out <- purrr::map_dfr(products, help_find_product, df) %>%
unique()
products
help_find_product <- function(product, df) {
quotemeta <- function(string) {
stringr::str_replace_all(string, "(\\W)", "\\\\\\1")
}
prod_up <- toupper(product)
prod_up <- substr(prod_up, 1, 50)
if (prod_up == "ALL") {
df2 <- df
} else {
df2 <- df[grep(quotemeta(prod_up), df$product_name), ]
df2 <- df2 %>% dplyr::mutate(product = product)
}
return(df2)
}
out <- purrr::map_dfr(products, help_find_product, df) %>%
unique()
out
?pull_chemical_codes
?find_chemical_codes
product
df2
df
devtools::load_all()
devtools::load_all()
source('~/Documents/purexposure/R/03-pull.R')
df <- pull_product_table(year)
source('~/Documents/purexposure/R/01-helpers.R')
out <- purrr::map_dfr(products, help_find_product, df) %>%
unique()
out
prod_df <- find_product_name(2000, "mosquito")
help_find_product
?pull_product_table
devtools::document()
find_product_name <- function(year, products = "all", download_progress) {
prod_df <- pull_product_table(year, download_progress = download_progress)
for (i in 1:length(products)) {
df <- help_find_product(products[i], prod_df)
if (i == 1) {
out <- df
} else {
out <- rbind(out, df)
}
}
out <- unique(out)
return(out)
}
prod_df <- find_product_name(2000, "mosquito")
find_product_name <- function(year, products = "all", download_progress = FALSE) {
prod_df <- pull_product_table(year, download_progress = download_progress)
for (i in 1:length(products)) {
df <- help_find_product(products[i], prod_df)
if (i == 1) {
out <- df
} else {
out <- rbind(out, df)
}
}
out <- unique(out)
return(out)
}
prod_df <- find_product_name(2000, "mosquito")
prod_df
prod_df <- find_product_name(2010, c("incecticide", "rodenticide")
)
prod_df
unique(prod_df$product)
prod_df <- find_product_name(2010, c("insecticide", "rodenticide"))
prod_df
devtools::document()
devtools::document()
?pull_product_table
prod_table <- pull_product_table(2003)
head(prod_table)
unqiue(prod_table$product_name)
unique(prod_table$product_name)
prod_table <- find_product_name(2003, "mosquito beater")
prod_table
prod_nos <- find_product_name(2003, "mosquito beater") %>%
dplyr::select(prodno) %>%
tibble_to_vector()
df3 <- pull_clean_pur(years = 2003) %>%
dplyr::filter(prodno %in% prod_nos)
df3
prod_nos <- find_product_name(2003, "insecticide") %>%
dplyr::select(prodno) %>%
tibble_to_vector()
prod_nos
df3 <- pull_clean_pur(2003) %>%
dplyr::filter(prodno %in% prod_nos)
df3
devtools::load_all()
prod_95 <- pull_product_table(1995)
year <- 1995
download_progress <- FALSE
url <- paste0("ftp://transfer.cdpr.ca.gov/pub/outgoing/pur_archives/pur",
year, ".zip")
file <- paste0("pur", year, ".zip")
current_dir <- getwd()
dir <- tempdir()
dir
if (download_progress) {
quiet <- FALSE
} else {
quiet <- TRUE
}
download.file(url, destfile = file, mode = "wb", quiet = quiet)
pull_product_table <- function(year, download_progress = FALSE) {
url <- paste0("ftp://transfer.cdpr.ca.gov/pub/outgoing/pur_archives/pur",
year, ".zip")
file <- paste0("pur", year, ".zip")
current_dir <- getwd()
dir <- tempdir()
if (download_progress) {
quiet <- FALSE
} else {
quiet <- TRUE
}
setwd(dir)
download.file(url, destfile = file, mode = "wb", quiet = quiet)
unzip(file, exdir = dir)
suppressWarnings(suppressMessages(
product_file <- readr::read_csv("product.txt") %>%
dplyr::select(prodno, prodstat_ind, product_name, signlwrd_ind) %>%
dplyr::mutate(prodno = as.integer(prodno),
prodstat_ind = as.character(prodstat_ind),
product_name = as.character(product_name),
signlwrd_ind = as.integer(signlwrd_ind),
year = as.integer(year))
))
setwd(current_dir)
return(product_file)
}
prod_95 <- pull_product_table(1995)
devtools::load_all()
devtools::load_all()
source('~/Documents/purexposure/R/00-misc.R')
source('~/Documents/purexposure/R/05-map.R')
