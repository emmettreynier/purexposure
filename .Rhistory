stop("The chem_code column should have integer values.")
}
if (!is.null(chemical_class) & is.data.frame(chemical_class) &
all(colnames(chemical_class) == c("chem_code", "chemname", "chemical_class")) &
!is.character(chemical_class$chemname)) {
stop("The chemname column should have character values.")
}
if (!is.null(chemical_class) & is.data.frame(chemical_class) &
all(colnames(chemical_class) == c("chem_code", "chemname", "chemical_class")) &
!is.character(chemical_class$chemical_class)) {
stop("The chemical_class column should have character values.")
}
if (unit == "section") {
if (aerial_ground) {
out <- help_sum_application(out, "chemical_class", "section", TRUE,
section_townships,
chemical_class = chemical_class,
chemical_class, section, county_name,
county_code, date, aerial_ground)
} else {
out <- help_sum_application(out, "chemical_class", "section", FALSE,
section_townships,
chemical_class = chemical_class,
chemical_class, section, county_name,
county_code, date)
}
} else if (unit == "township") {
if (aerial_ground) {
out <- help_sum_application(out, "chemical_class", "township", TRUE,
section_townships,
chemical_class = chemical_class,
chemical_class, township, county_name,
county_code, date, aerial_ground)
} else {
out <- help_sum_application(out, "chemical_class", "township", FALSE,
section_townships,
chemical_class = chemical_class,
chemical_class, township, county_name,
county_code, date)
}
}
}
} else {
if (!aerial_ground) {
out <- out %>% dplyr::select(-aerial_ground)
}
}
if ("prodno" %in% colnames(out)) {
out <- out %>% dplyr::mutate(prodno = as.integer(prodno))
}
return(out)
out
devtools::load_all()
clean_pur4 <- pull_clean_pur(2000, "yolo")
purexposure::county_codes
as.data.frame(purexposure::county_codes)
df6 <- pull_raw_pur(1995, "solano") %>% pull_clean_pur()
devtools::load_all()
setwd("~/Documents/purexposure")
devtools::load_all()
df6 <- pull_raw_pur(1995, "solano") %>% pull_clean_pur()
solano_95 <- pull_raw_pur(1995, "solano")
solano_95
solano_95$applic_dt
df6 <- pull_clean_pur(raw_pur_df = solano_95)
raw_pur_df = solano_95
is.null(raw_pur_df)
check <- colnames(raw_pur_df == c("use_no", "prodno", "chem_code",
"prodchem_pct", "lbs_chm_used",
"lbs_prd_used", "amt_prd_used",
"unit_of_meas", "acre_planted",
"unit_planted", "acre_treated",
"unit_treated", "applic_cnt", "applic_dt",
"applic_time", "county_cd", "base_ln_mer",
"township", "tship_dir", "range",
"range_dir", "section", "site_loc_id",
"grower_id", "license_no", "planting_seq",
"aer_gnd_ind", "site_code", "qualify_cd",
"batch_no", "document_no", "summary_cd",
"record_id"))
check
check <- colnames(raw_pur_df) == c("use_no", "prodno", "chem_code",
"prodchem_pct", "lbs_chm_used",
"lbs_prd_used", "amt_prd_used",
"unit_of_meas", "acre_planted",
"unit_planted", "acre_treated",
"unit_treated", "applic_cnt", "applic_dt",
"applic_time", "county_cd", "base_ln_mer",
"township", "tship_dir", "range",
"range_dir", "section", "site_loc_id",
"grower_id", "license_no", "planting_seq",
"aer_gnd_ind", "site_code", "qualify_cd",
"batch_no", "document_no", "summary_cd",
"record_id")
check
all(check)
devtools::load_all()
solano_95
df6 <- pull_clean_pur(raw_pur_df = solano_95)
devtools::load_all()
df6 <- pull_clean_pur(raw_pur_df = solano_95)
df6
toy <- data.frame(a = c(1:3, "/3", 0))
toy
toy <- data.frame(a = c(1:3, "?3", 0))
toy
c(grep("\\?", toy$a, value = TRUE), grep("0", toy$a, value = TRUE))
c(grep("\\\\", toy$a, value = TRUE), grep("0", toy$a, value = TRUE))
devtools::load_all()
df6 <- pull_clean_pur(raw_pur_df = solano_95)
devtools::load_all()
solano_95 <- pull_raw_pur(1995, "solano")
df6 <- pull_clean_pur(raw_pur_df = solano_95)
devtools::load_all()
df6 <- pull_clean_pur(raw_pur_df = solano_95)
df6
as.data.frame(purexposure::county_codes)
placer_05 <- pull_raw_pur(2005, "placer")
df6 <- pull_clean_pur(raw_pur_df = solano_95)
df6
df6 <- pull_clean_pur(raw_pur_df = placer_05)
df6
placer_05
devtools::load_all()
clean_pur <- pull_clean_pur(1990:2015, "fresno", chemicals = "methyl bromide",
raw_df = readRDS("~/Desktop/raw_df_ex.rds"))
clean_pur <- pull_clean_pur(1990:2015, "fresno", chemicals = "methyl bromide",
raw_pur_df = readRDS("~/Desktop/raw_df_ex.rds"))
clean_pur
clean_pur_df %>%
dplyr::mutate(year = lubridate::year(date)) %>%
dplyr::group_by(date, chemname) %>%
dplyr::summarise(lbs_perday = sum(lbs_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = lbs_perday)) +
ggplot2::geom_line() +
ggplot2::facet_wrap(~chemical, scales = "free_y") +
ggplot2::theme_minimal() +
ggplot2::labs(x = "Application year",
y = "Pounds of chemical applied per day ")
clean_pur %>%
dplyr::mutate(year = lubridate::year(date)) %>%
dplyr::group_by(date, chemname) %>%
dplyr::summarise(lbs_perday = sum(lbs_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = lbs_perday)) +
ggplot2::geom_line() +
ggplot2::facet_wrap(~chemical, scales = "free_y") +
ggplot2::theme_minimal() +
ggplot2::labs(x = "Application year",
y = "Pounds of chemical applied per day ")
clean_pur %>%
dplyr::mutate(year = lubridate::year(date)) %>%
dplyr::group_by(date, chemname) %>%
dplyr::summarise(lbs_perday = sum(kg_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = kg_perday)) +
ggplot2::geom_line() +
ggplot2::facet_wrap(~chemical, scales = "free_y") +
ggplot2::theme_minimal() +
ggplot2::labs(x = "Application year",
y = "Kilograms of chemical applied per day ")
clean_pur %>%
dplyr::mutate(year = lubridate::year(date)) %>%
dplyr::group_by(date, chemname) %>%
dplyr::summarise(lbs_perday = sum(kg_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = kg_perday)) +
ggplot2::geom_line() +
ggplot2::facet_wrap(~chemname, scales = "free_y") +
ggplot2::theme_minimal() +
ggplot2::labs(x = "Application year",
y = "Kilograms of chemical applied per day ")
clean_pur %>%
dplyr::mutate(year = lubridate::year(date)) %>%
dplyr::group_by(date, chemname) %>%
dplyr::summarise(kg_perday = sum(kg_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = kg_perday)) +
ggplot2::geom_line() +
ggplot2::facet_wrap(~chemname, scales = "free_y") +
ggplot2::theme_minimal() +
ggplot2::labs(x = "Application year",
y = "Kilograms of chemical applied per day ")
clean_pur %>%
dplyr::mutate(year = lubridate::year(date)) %>%
dplyr::group_by(date, chemname) %>%
dplyr::summarise(kg_perday = sum(kg_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = kg_perday)) +
ggplot2::geom_line() +
ggplot2::facet_wrap(~chemname, scales = NULL) +
ggplot2::theme_minimal() +
ggplot2::labs(x = "Application year",
y = "Kilograms of chemical applied per day ")
?facet_wrap
clean_pur_df <- clean_pur
plot <- clean_pur_df %>%
dplyr::group_by(date, chemname) %>%
dplyr::summarise(kg_perday = sum(kg_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = kg_perday)) +
ggplot2::geom_line() +
ggplot2::facet_wrap(~chemname, scales = "free_y") +
ggplot2::theme_minimal() +
ggplot2::labs(x = "Application year",
y = "Kilograms of chemical applied per day ")
plot
class(plot)
facet_by = "chemname"
y_axis = "fixed"
clean_pur_df %>%
dplyr::group_by(date, facet_by) %>%
dplyr::summarise(kg_perday = sum(kg_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = kg_perday)) +
ggplot2::geom_line() +
ggplot2::facet_wrap(~facet_by, scales = y_axis) +
ggplot2::theme_minimal() +
ggplot2::labs(x = "Application year",
y = "Kilograms of chemical applied per day ")
?facet_wrap
?substitute
clean_pur_df %>%
dplyr::group_by(date, facet_by) %>%
dplyr::summarise(kg_perday = sum(kg_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = kg_perday)) +
ggplot2::geom_line() +
ggplot2::facet_wrap(~substitute(facet_by), scales = y_axis) +
ggplot2::theme_minimal() +
ggplot2::labs(x = "Application year",
y = "Kilograms of chemical applied per day ")
facet_by
substitute(facet_by)
clean_pur_df %>%
dplyr::group_by(date, facet_by) %>%
dplyr::summarise(kg_perday = sum(kg_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = kg_perday)) +
ggplot2::geom_line() +
ggplot2::facet_wrap(substitute(facet_by), scales = y_axis) +
ggplot2::theme_minimal() +
ggplot2::labs(x = "Application year",
y = "Kilograms of chemical applied per day ")
plot_application_timeseries <- function(clean_pur_df, facet = FALSE,
y_axis = "fixed") {
if (facet) {
if ("chemname" %in% colnames(clean_pur_df)) {
plot <- clean_pur_df %>%
dplyr::group_by(date, chemname)
} else if ("chemical_class" %in% colnames(clean_pur_df)) {
plot <- clean_pur_df %>%
dplyr::group_by(date, chemical_class)
}
} else {
plot <- clean_pur_df %>%
dplyr::group_by(date)
}
plot <- plot %>%
dplyr::summarise(kg_perday = sum(kg_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = kg_perday)) +
ggplot2::geom_line() +
ggthemes::theme_base() +
ggplot2::labs(x = "Application date",
y = "Kilograms of active ingredient applied per day ")
if (facet) {
if ("chemname" %in% colnames(clean_pur_df)) {
plot <- plot %>%
facet_wrap(~chemname, scales = y_axis)
} else if ("chemical_class" %in% colnames(clean_pur_df)) {
plot <- plot %>%
facet_wrap(~chemical_class, scales = y_axis )
}
}
plot <- clean_pur_df %>%
dplyr::group_by(date, ~facet_by) %>%
ggplot2::facet_wrap(substitute(facet_by), scales = y_axis) +
}
plot_application_timeseries <- function(clean_pur_df, facet = FALSE,
y_axis = "fixed") {
if (facet) {
if ("chemname" %in% colnames(clean_pur_df)) {
plot <- clean_pur_df %>%
dplyr::group_by(date, chemname)
} else if ("chemical_class" %in% colnames(clean_pur_df)) {
plot <- clean_pur_df %>%
dplyr::group_by(date, chemical_class)
}
} else {
plot <- clean_pur_df %>%
dplyr::group_by(date)
}
plot <- plot %>%
dplyr::summarise(kg_perday = sum(kg_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = kg_perday)) +
ggplot2::geom_line() +
ggthemes::theme_base() +
ggplot2::labs(x = "Application date",
y = "Kilograms of active ingredient applied per day ")
if (facet) {
if ("chemname" %in% colnames(clean_pur_df)) {
plot <- plot %>%
facet_wrap(~chemname, scales = y_axis)
} else if ("chemical_class" %in% colnames(clean_pur_df)) {
plot <- plot %>%
facet_wrap(~chemical_class, scales = y_axis )
}
}
return(plot)
}
pull_clean_pur(1990:2000, "fresno", chemicals = "methyl bromide") %>%
plot_application_timeseries()
test <- pull_clean_pur(1990:1992, "fresno")
head(test)
library(dplyr)
head9test
head(test)
test %>% group_by(chemname, date) %>% summarise(kg = sum(kg_chm_used, na.rm = TRUE)) %>% arrange()
test %>% group_by(chemname, date) %>% summarise(kg = sum(kg_chm_used, na.rm = TRUE)) %>% arrange(desc(kg_chm_used))
test %>% group_by(chemname, date) %>% summarise(kg = sum(kg_chm_used, na.rm = TRUE)) %>% arrange(desc(kg))
devtools::load_all()
pull_clean_pur(1990:1992, "fresno", chemicals = c("methyl bromide",
"sulfur")) %>%
plot_application_timeseries(facet = TRUE)
plot_application_timeseries <- function(clean_pur_df, facet = FALSE,
y_axis = "fixed") {
if (facet) {
if ("chemname" %in% colnames(clean_pur_df)) {
plot <- clean_pur_df %>%
dplyr::group_by(date, chemname)
} else if ("chemical_class" %in% colnames(clean_pur_df)) {
plot <- clean_pur_df %>%
dplyr::group_by(date, chemical_class)
}
} else {
plot <- clean_pur_df %>%
dplyr::group_by(date)
}
plot <- plot %>%
dplyr::summarise(kg_perday = sum(kg_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = kg_perday)) +
ggplot2::geom_line() +
ggthemes::theme_base() +
ggplot2::labs(x = "Application date",
y = "Kilograms of active ingredient applied per day ")
if (facet) {
if ("chemname" %in% colnames(clean_pur_df)) {
plot <- plot %>%
ggplot2::facet_wrap(~chemname, scales = y_axis)
} else if ("chemical_class" %in% colnames(clean_pur_df)) {
plot <- plot %>%
ggplot2::facet_wrap(~chemical_class, scales = y_axis )
}
}
return(plot)
}
pull_clean_pur(1990:1992, "fresno", chemicals = c("methyl bromide",
"sulfur")) %>%
plot_application_timeseries(facet = TRUE)
clean_pur_df <- pull_clean_pur(1990:1992, "fresno", chemicals = c("methyl bromide",                                                "sulfur"))
clean_pur_df
facet
facet <- TRUE
y_axis <- "fixed"
if (facet) {
if ("chemname" %in% colnames(clean_pur_df)) {
plot <- clean_pur_df %>%
dplyr::group_by(date, chemname)
} else if ("chemical_class" %in% colnames(clean_pur_df)) {
plot <- clean_pur_df %>%
dplyr::group_by(date, chemical_class)
}
} else {
plot <- clean_pur_df %>%
dplyr::group_by(date)
}
plot
plot <- plot %>%
dplyr::summarise(kg_perday = sum(kg_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = kg_perday)) +
ggplot2::geom_line() +
ggthemes::theme_base() +
ggplot2::labs(x = "Application date",
y = "Kilograms of active ingredient applied per day ")
plot
if (facet) {
if ("chemname" %in% colnames(clean_pur_df)) {
plot <- plot %>%
ggplot2::facet_wrap(~chemname, scales = y_axis)
} else if ("chemical_class" %in% colnames(clean_pur_df)) {
plot <- plot %>%
ggplot2::facet_wrap(~chemical_class, scales = y_axis )
}
}
plot %>%
ggplot2::facet_wrap(~chemname, scales = y_axis)
y_axis
chemname
plot_application_timeseries <- function(clean_pur_df, facet = FALSE,
y_axis = "fixed") {
if (facet) {
if ("chemname" %in% colnames(clean_pur_df)) {
plot <- clean_pur_df %>%
dplyr::group_by(date, chemname)
} else if ("chemical_class" %in% colnames(clean_pur_df)) {
plot <- clean_pur_df %>%
dplyr::group_by(date, chemical_class)
}
} else {
plot <- clean_pur_df %>%
dplyr::group_by(date)
}
plot <- plot %>%
dplyr::summarise(kg_perday = sum(kg_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = kg_perday)) +
ggplot2::geom_line() +
ggthemes::theme_base() +
ggplot2::labs(x = "Application date",
y = "Kilograms of active ingredient applied per day ")
if (facet) {
if ("chemname" %in% colnames(clean_pur_df)) {
plot <- plot +
ggplot2::facet_wrap(~chemname, scales = y_axis)
} else if ("chemical_class" %in% colnames(clean_pur_df)) {
plot <- plot +
ggplot2::facet_wrap(~chemical_class, scales = y_axis )
}
}
return(plot)
}
pull_clean_pur(1990:1992, "fresno", chemicals = c("methyl bromide",
"sulfur")) %>%
plot_application_timeseries(facet = TRUE)
plot_application_timeseries <- function(clean_pur_df, facet = FALSE,
y_axis = "fixed") {
if (facet) {
if ("chemname" %in% colnames(clean_pur_df)) {
plot <- clean_pur_df %>%
dplyr::group_by(date, chemname)
} else if ("chemical_class" %in% colnames(clean_pur_df)) {
plot <- clean_pur_df %>%
dplyr::group_by(date, chemical_class)
}
} else {
plot <- clean_pur_df %>%
dplyr::group_by(date)
}
plot <- plot %>%
dplyr::summarise(kg_perday = sum(kg_chm_used, na.rm = TRUE)) %>%
ggplot2::ggplot(ggplot2::aes(x = date, y = kg_perday)) +
ggplot2::geom_line() +
ggplot2::theme_minimal() +
ggplot2::labs(x = "Application date",
y = "Kilograms of active ingredient\napplied per day ")
if (facet) {
if ("chemname" %in% colnames(clean_pur_df)) {
plot <- plot +
ggplot2::facet_wrap(~chemname, scales = y_axis)
} else if ("chemical_class" %in% colnames(clean_pur_df)) {
plot <- plot +
ggplot2::facet_wrap(~chemical_class, scales = y_axis )
}
}
return(plot)
}
pull_clean_pur(1990:1992, "fresno") %>%
dplyr::filter(chemname %in% c("methyl bromide", "sulfur")) %>%
plot_application_timeseries(facet = TRUE)
test <- pull_clean_pur(1990:1992, "fresno")
pull_clean_pur(1990:1992, "fresno") %>%
dplyr::filter(chemname %in% toupper(c("methyl bromide", "sulfur"))) %>%
plot_application_timeseries(facet = TRUE)
as.data.frame(purexposure::county_codes)
pull_clean_pur(2000, "riverside") %>% plot_application_timeseries()
devtools::document()
setwd("~/Documents/purexposure")
pull_clean_pur(2000, "riverside") %>% plot_application_timeseries()
devtools::document()
source('~/Documents/purexposure/R/02-find.R')
prod_df <- find_product_name(2000, "mosquito")
source('~/Documents/purexposure/R/02-find.R')
source('~/Documents/purexposure/R/03-pull.R')
source('~/Documents/purexposure/R/05-plot.R')
devtools::document()
?purexposure
devtools::document()
devtools::document()
?purexposure
devtools::document()
?purexposure
devtools::document()
?purexposure
devtools::document()
?purexposure
devtools::document()
?purexposure
?build_manual
devtools::build_manual()
devtools::build_manual(path = "~/Desktop")
pkg <- "."
path <- "~/Desktop"
pkg <- as.package(pkg)
?build_manual
Rd2pdf(files = list.files("man"))
RdUtils::Rd2pdf(files = list.files("man"))
library(purexposure)
library(purexposure)
pack <- "purexposure"
path <- find.package(pack)
system(paste(shQuote(file.path(R.home("bind"), "R")), "CMD", "Rd2pdf", shQuote(path)))
system(paste(shQuote(file.path(R.home("bin"), "R")), "CMD", "Rd2pdf", shQuote(path)))
library(tools)
devtools::build_manual()
devtools::build_manual()
devtools::build_manual()
sessionInfo()
library(tidyverse)
sessionInfo()
?pull_clean_pur
devtools::load_all()
?pull_clean_pur
